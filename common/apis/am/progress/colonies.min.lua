local a=require("cc.expect")require(settings.get("ghu.base").."core/apis/ghu")local b=require("am.ui.base").BaseObject;local c=require("am.ui")local d=require("am.event")local e=require("am.progress.base")local f=b:extend("am.progress.ColonyProgress")function f:init(g)f.super.init(self)self.id=g;self.status=nil;return self end;local h=e:extend("am.progress.QuarryWrapper")function h:init(i,g,j)h.super.init(self,i,f(g),j)self.names={[d.c.Event.Colonies.status_poll]=true}return self end;function h:createMainTab(k)local l=self.frame.id;local m=k:getTab(1)local n=3;local o=1;m:add(c.Text(c.a.Left(o),"Raid"))m:add(c.Text(c.a.Right(o,n),"",{id=l..".raid"}))o=o+1;m:add(c.Text(c.a.Left(o),"Happiness"))m:add(c.Text(c.a.Right(o,n),"",{id=l..".happiness"}))o=o+1;m:add(c.Text(c.a.Left(o),"Citizens"))m:add(c.Text(c.a.Right(o,n),"/",{id=l..".citizens"}))local p=c.Button(c.a.Right(o),"\x17",{id=l..".citizenTabButton",fillColor=colors.blue,textColor=colors.white,border=0})p:addActivateHandler(function()k:setActive(2)end)m:add(p)o=o+1;m:add(c.Text(c.a.Left(o),"Graves"))m:add(c.Text(c.a.Right(o,n),"",{id=l..".graves"}))o=o+1;m:add(c.Text(c.a.Left(o),"Contructions"))m:add(c.Text(c.a.Right(o,n),"",{id=l..".contructions"}))o=o+1;m:add(c.Text(c.a.Left(o),"Requests"))local q=c.Button(c.a.Right(o),"\x17",{id=l..".requestsTabButton",fillColor=colors.blue,textColor=colors.white,border=0})q:addActivateHandler(function()k:setActive(3)end)m:add(q)m:add(c.Text(c.a.Right(o,n),"",{id=l..".requests"}))o=o+1;m:add(c.Text(c.a.Left(o),"Buildings"))m:add(c.Text(c.a.Right(o,n),"",{id=l..".buildings"}))local r=c.Button(c.a.Right(o),"\x17",{id=l..".buildingsTabButton",fillColor=colors.red,textColor=colors.white,border=0})r:addActivateHandler(function()k:setActive(4)end)m:add(r)o=o+1;m:add(c.Text(c.a.Left(o),"Visitors"))m:add(c.Text(c.a.Right(o,n),"",{id=l..".visitors"}))local s=c.Button(c.a.Right(o),"\x17",{id=l..".visitorsTabButton",fillColor=colors.green,textColor=colors.white,border=0})s:addActivateHandler(function()k:setActive(5)end)m:add(s)o=o+1;m:add(c.Text(c.a.Left(o),"Players"))local t=c.Button(c.a.Right(o),"\x17",{id=l..".playersTabButton",fillColor=colors.blue,textColor=colors.white,border=0})t:addActivateHandler(function()k:setActive(6)end)m:add(t)m:add(c.Text(c.a.Right(o,n),"",{id=l..".players"}))end;function h:createCitizensTab(k,u)local l=self.frame.id;local m=k:createTab("citizens")m:add(c.Text(c.a.TopLeft(),"Citizens"))local v=c.Button(c.a.TopRight(),"x",{id=l..".citizenCloseButton",fillColor=colors.red,border=0})v:addActivateHandler(function()k:setActive(1)end)m:add(v)local w=c.Frame(c.a.Anchor(1,2),{id=l..".citizenListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=u-1,border=0,padTop=1,padLeft=1})w:add(c.Text(c.a.TopLeft(),"",{id=l..".citizenList"}))m:add(w)end;function h:createRequestsTab(k,u)local l=self.frame.id;local m=k:createTab("requests")m:add(c.Text(c.a.TopLeft(),"Requests"))local v=c.Button(c.a.TopRight(),"x",{id=l..".requestCloseButton",fillColor=colors.red,border=0})v:addActivateHandler(function()k:setActive(1)end)m:add(v)local x=c.Frame(c.a.Anchor(1,2),{id=l..".requestListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=u-1,border=0,padTop=1,padLeft=1})x:add(c.Text(c.a.TopLeft(),"",{id=l..".requestList"}))m:add(x)end;function h:createBuildingsTab(k,u)local l=self.frame.id;local m=k:createTab("buildings")m:add(c.Text(c.a.TopLeft(),"Buildings"))local v=c.Button(c.a.TopRight(),"x",{id=l..".buildingCloseButton",fillColor=colors.red,border=0})v:addActivateHandler(function()k:setActive(1)end)m:add(v)local y=c.Frame(c.a.Anchor(1,2),{id=l..".buildingListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=u-1,border=0,padTop=1,padLeft=1})y:add(c.Text(c.a.TopLeft(),"",{id=l..".buildingList"}))m:add(y)end;function h:createVisitorsTab(k,u)local l=self.frame.id;local m=k:createTab("visitors")m:add(c.Text(c.a.TopLeft(),"Visitors"))local v=c.Button(c.a.TopRight(),"x",{id=l..".visitorCloseButton",fillColor=colors.red,border=0})v:addActivateHandler(function()k:setActive(1)end)m:add(v)local z=c.Frame(c.a.Anchor(1,2),{id=l..".visitorListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=u-1,border=0,padTop=1,padLeft=1})z:add(c.Text(c.a.TopLeft(),"",{id=l..".visitorList"}))m:add(z)end;function h:createPlayersTab(k,u)local l=self.frame.id;local m=k:createTab("players")m:add(c.Text(c.a.TopLeft(),"Players"))local v=c.Button(c.a.TopRight(),"x",{id=l..".playerCloseButton",fillColor=colors.red,border=0})v:addActivateHandler(function()k:setActive(1)end)m:add(v)local A=c.Frame(c.a.Anchor(1,2),{id=l..".playerListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=u-1,border=0,padTop=1,padLeft=1})A:add(c.Text(c.a.TopLeft(),"",{id=l..".playerList"}))m:add(A)end;function h:createUI()local l=self.frame.id;local B,u=self.output.getSize()local C=u-2;self.frame:add(c.Text(c.a.Top(),"",{id=l..".titleText"}))if _G.RUN_PROGRESS and c.h.isTerm(self.output)then local v=c.Button(c.a.TopRight(),"x",{id=l..".closeButton",fillColor=colors.red,border=0})v:addActivateHandler(function()_G.RUN_PROGRESS=false end)self.frame:add(v)end;local k=c.TabbedFrame(c.a.Anchor(1,3),{id=l..".tabsBase",fillColor=colors.black,textColor=colors.white,border=0,fillVertical=true,fillHorizontal=true})local D=k:bind(self.output)self:createMainTab(D)self:createCitizensTab(D,C)self:createRequestsTab(D,C)self:createBuildingsTab(D,C)self:createVisitorsTab(D,C)self:createPlayersTab(D,C)D:setActive(1)self.frame:add(k)h.super.createUI(self)end;function h:updateMainTab(k)local E=self.progress.status;local l=self.frame.id;local m=k:getTab(1)local F=m:get(l..".raid")if E.raid then F.obj.textColor=colors.red;F:update("Yes")else F.obj.textColor=colors.green;F:update("No")end;local G=m:get(l..".happiness")if E.happiness<5 then G.obj.textColor=colors.red elseif E.happiness<8 then G.obj.textColor=colors.yellow else G.obj.textColor=colors.green end;G:update(string.format("%d/10",self.progress.status.happiness))local H=m:get(l..".citizens")local I=E.tavernCount*4;local J=E.maxCitizens-I;if E.citizenCount==J then H.obj.textColor=colors.green elseif E.citizenCount>E.maxCitizens then H.obj.textColor=colors.red else H.obj.textColor=colors.yellow end;H:update(string.format("%d/%d",E.citizenCount,E.maxCitizens))local K=m:get(l..".graves")if E.graves>0 then K.obj.textColor=colors.red else K.obj.textColor=colors.green end;K:update(tostring(E.graves))local L=m:get(l..".contructions")L:update(tostring(E.constructionCount))local M=m:get(l..".requests")if#E.requests>0 then M.obj.textColor=colors.yellow else M.obj.textColor=colors.green end;M:update(tostring(#E.requests))local N=m:get(l..".buildings")N:update(tostring(#E.buildings))local O=m:get(l..".visitors")O:update(tostring(E.visitorCount))local P=m:get(l..".players")P:update(tostring(#E.players))end;function h:updateCitizensTab(k,u)local E=self.progress.status;local l=self.frame.id;local m=k:getTab(2)local w=m:get(l..".citizenListFrame")local Q=math.max(u-1,E.citizenCount)if w.obj.height~=Q then w.obj.height=Q;w:render()end;local R=m:get(l..".citizenList")local S={}for B,T in pairs(E.citizens)do local U="Unemployed"if T.job~=nil then U=T.job end;S[#S+1]=string.format("%s %s",U,T.name)end;table.sort(S)R:update(S)end;function h:updateRequestsTab(k,u)local E=self.progress.status;local l=self.frame.id;local m=k:getTab(3)local x=m:get(l..".requestListFrame")local Q=math.max(u-1,#E.requests)if x.obj.height~=Q then x.obj.height=Q;x:render()end;local V=m:get(l..".requestList")local W={}for B,X in pairs(E.requests)do W[#W+1]=X.desc end;table.sort(W)V:update(W)end;function h:updateBuildingsTab(k,u)local E=self.progress.status;local l=self.frame.id;local m=k:getTab(4)local y=m:get(l..".buildingListFrame")local Q=math.max(u-1,#E.buildings)if y.obj.height~=Q then y.obj.height=Q;y:render()end;local Y=m:get(l..".buildingList")local Z={}for B,_ in pairs(E.buildings)do local a0=string.gsub(_.type,"^%l",string.upper)Z[#Z+1]=string.format("L%d %s",_.level,a0)end;table.sort(Z)Y:update(Z)end;function h:updateVisitorsTab(k,u)local E=self.progress.status;local l=self.frame.id;local m=k:getTab(5)local z=m:get(l..".visitorListFrame")local Q=math.max(u-1,E.visitorCount)if z.obj.height~=Q then z.obj.height=Q;z:render()end;local a1=m:get(l..".visitorList")local a2={}for B,a3 in pairs(E.visitors)do a2[#a2+1]=a3.name end;table.sort(a2)a1:update(a2)end;function h:updatePlayersTab(k,u)local E=self.progress.status;local l=self.frame.id;local m=k:getTab(6)local A=m:get(l..".playerListFrame")local Q=math.max(u-1,#E.players)if A.obj.height~=Q then A.obj.height=Q;A:render()end;local a4=m:get(l..".playerList")local a5={}for B,a6 in pairs(E.players)do a5[#a5+1]=string.format("%s %s",a6.rank,a6.name)end;table.sort(a5)a4:update(a5)end;function h:update(a7)local B,u=self.output.getSize()if a7.name==d.c.Event.Colonies.status_poll then self.progress.status=a7.status end;local a8=self.frame:get(self.frame.id..".titleText")a8:update(self.progress.status.name)local k=self.frame:get(self.frame.id..".tabsBase")self:updateMainTab(k)self:updateCitizensTab(k,u)self:updateRequestsTab(k,u)self:updateBuildingsTab(k,u)self:updateVisitorsTab(k,u)self:updatePlayersTab(k,u)end;function h:handle(a7,a9)if a7==d.c.Event.Colonies.status_poll then self:update(a9[1])else self.frame:handle(self.output,{a7,table.unpack(a9)})end end;return h
