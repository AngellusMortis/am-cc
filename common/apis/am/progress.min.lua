local a=require("cc.expect")require(settings.get("ghu.base").."core/apis/ghu")local b=require("am.ui")local c=require("am.event")local d=require("am.core")local e=require("am.progress.helpers")local f=require("am.progress.quarry")local g=require("am.progress.tree")local h=require("am.progress.colonies")local i={}local j={}local function k(l)return b.Frame(b.a.Anchor(1,1),{id="frame."+l.id,fillHorizontal=true,fillVertical=true,border=0,backgroundColor=colors.black,textColor=colors.white})end;local function m(l,n,o)a.expect(1,l,"table")a.expect(2,o,"table","nil")a.expect(3,n,"table","nil")local p=o~=nil and n~=nil;if o~=nil then b.h.requireOutput(o)end;local q=j[l.id]local r=false;if p then if q~=nil then if not q.names[n.name]or not b.h.isSameScreen(q.screen.output,o)then j[l.id]=nil;q=nil end end;if q==nil then if n.name==c.c.Event.Progress.quarry then q=f(l,n,o,k(l))q:createUI()j[l.id]=q elseif n.name==c.c.Event.Progress.tree then q=g(l,n,o,k(l))q:createUI()j[l.id]=q elseif n.name==c.c.Event.Colonies.status_poll then q=h(l,n.status.id,o,k(l))q.progress.status=n.status;q:createUI()j[l.id]=q end;r=q~=nil end end;return q,r end;local function s(o)for t,q in pairs(j)do if b.h.isSameScreen(o,q.screen.output)then return{id=t}end end;return nil end;local function u(l,v)a.expect(1,l,"table")a.expect(2,v,"string")local q=m(l)if q~=nil then q:updateStatus(v)end end;local function w(l,n,o)a.expect(1,l,"table")a.expect(2,n,"table")a.expect(3,o,"table","nil")if o==nil then o=term else b.h.requireOutput(o)end;local q,r=m(l,n,o)if q~=nil and not r then q:update(n)end end;local function x(n,y)for z,q in pairs(j)do q:handle(n,y)end end;local function A(l,n,y)local B=nil;if b.c.l.Events.Always[n]then x(n,y)return elseif b.c.l.Events.UI[n]then local C=d.split(y[1].objId,".")if C[1]=="screen"then B={id=tonumber(C[2])}end elseif b.c.l.Events.Terminal[n]then B=s(term)elseif b.c.l.Events.Monitor[n]then B=s(peripheral.wrap(y[1]))end;if B~=nil then l=B end;local q,z=m(l)if q~=nil then q:handle(n,y)end end;i.updateStatus=u;i.print=w;i.handle=A;i.itemStrings=e.itemStrings;return i
