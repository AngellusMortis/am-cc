local a=require("cc.expect")require(settings.get("ghu.base").."core/apis/ghu")local b=require("am.ui.base").BaseObject;local c=require("am.ui")local d=require("am.event")local e=require("am.progress.base")local f=b:extend("am.progress.ColonyProgress")function f:init(g)f.super.init(self)self.id=g;self.status=nil;return self end;local h=e:extend("am.progress.QuarryWrapper")function h:init(i,g,j,k)h.super.init(self,i,f(g),j,k)self.names={[d.c.Event.Colonies.status_poll]=true}return self end;function h:createMainTab(l)local m=self:getBaseId()local n=l:getTab("main").obj;local o=3;local p=1;n:add(c.Text(c.a.Left(p),"Raid"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".raid"}))p=p+1;n:add(c.Text(c.a.Left(p),"Happiness"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".happiness"}))p=p+1;n:add(c.Text(c.a.Left(p),"Citizens"))n:add(c.Text(c.a.Right(p,o),"/",{id=m..".citizens"}))local q=c.Button(c.a.Right(p),"\x17",{id=m..".citizenTabButton",fillColor=colors.blue,textColor=colors.white,border=0})q:addActivateHandler(function()l:setActive("citizens")end)n:add(q)p=p+1;n:add(c.Text(c.a.Left(p),"Graves"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".graves"}))p=p+1;n:add(c.Text(c.a.Left(p),"Contructions"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".contructions"}))p=p+1;n:add(c.Text(c.a.Left(p),"Requests"))local r=c.Button(c.a.Right(p),"\x17",{id=m..".requestsTabButton",fillColor=colors.blue,textColor=colors.white,border=0})r:addActivateHandler(function()l:setActive("requests")end)n:add(r)n:add(c.Text(c.a.Right(p,o),"",{id=m..".requests"}))p=p+1;n:add(c.Text(c.a.Left(p),"Buildings"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".buildings"}))local s=c.Button(c.a.Right(p),"\x17",{id=m..".buildingsTabButton",fillColor=colors.red,textColor=colors.white,border=0})s:addActivateHandler(function()l:setActive("buildings")end)n:add(s)p=p+1;n:add(c.Text(c.a.Left(p),"Visitors"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".visitors"}))local t=c.Button(c.a.Right(p),"\x17",{id=m..".visitorsTabButton",fillColor=colors.green,textColor=colors.white,border=0})t:addActivateHandler(function()l:setActive("visitors")end)n:add(t)p=p+1;n:add(c.Text(c.a.Left(p),"Players"))local u=c.Button(c.a.Right(p),"\x17",{id=m..".playersTabButton",fillColor=colors.blue,textColor=colors.white,border=0})u:addActivateHandler(function()l:setActive("players")end)n:add(u)n:add(c.Text(c.a.Right(p,o),"",{id=m..".players"}))end;function h:createCitizensTab(l,v)local m=self:getBaseId()local n=l:createTab("citizens")n:add(c.Text(c.a.TopLeft(),"Citizens"))local w=c.Button(c.a.TopRight(),"x",{id=m..".citizenCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local x=c.Frame(c.a.Anchor(1,2),{id=m..".citizenListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})x:add(c.Text(c.a.TopLeft(),"",{id=m..".citizenList"}))n:add(x)end;function h:createRequestsTab(l,v)local m=self:getBaseId()local n=l:createTab("requests")n:add(c.Text(c.a.TopLeft(),"Requests"))local w=c.Button(c.a.TopRight(),"x",{id=m..".requestCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local y=c.Frame(c.a.Anchor(1,2),{id=m..".requestListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})y:add(c.Text(c.a.TopLeft(),"",{id=m..".requestList"}))n:add(y)end;function h:createBuildingsTab(l,v)local m=self:getBaseId()local n=l:createTab("buildings")n:add(c.Text(c.a.TopLeft(),"Buildings"))local w=c.Button(c.a.TopRight(),"x",{id=m..".buildingCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local z=c.Frame(c.a.Anchor(1,2),{id=m..".buildingListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})z:add(c.Text(c.a.TopLeft(),"",{id=m..".buildingList"}))n:add(z)end;function h:createVisitorsTab(l,v)local m=self:getBaseId()local n=l:createTab("visitors")n:add(c.Text(c.a.TopLeft(),"Visitors"))local w=c.Button(c.a.TopRight(),"x",{id=m..".visitorCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local A=c.Frame(c.a.Anchor(1,2),{id=m..".visitorListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})A:add(c.Text(c.a.TopLeft(),"",{id=m..".visitorList"}))n:add(A)end;function h:createPlayersTab(l,v)local m=self:getBaseId()local n=l:createTab("players")n:add(c.Text(c.a.TopLeft(),"Players"))local w=c.Button(c.a.TopRight(),"x",{id=m..".playerCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local B=c.Frame(c.a.Anchor(1,2),{id=m..".playerListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})B:add(c.Text(c.a.TopLeft(),"",{id=m..".playerList"}))n:add(B)end;function h:createUI()local m=self:getBaseId()local C,v=self.output.getSize()local D=v-2;self.frame:add(c.Text(c.a.Top(),"",{id=m..".titleText"}))if _G.PROGRESS_SHOW_CLOSE then local w=c.Button(c.a.TopRight(),"x",{id=m..".closeButton",fillColor=colors.red,border=0})w:addActivateHandler(function()_G.RUN_PROGRESS=false end)self.frame:add(w)end;local l=c.TabbedFrame(c.a.Anchor(1,3),{id=m..".tabsBase",fillColor=colors.black,textColor=colors.white,border=0,fillVertical=true,fillHorizontal=true})local E=l:bind(self.output)self:createMainTab(E)self:createCitizensTab(E,D)self:createRequestsTab(E,D)self:createBuildingsTab(E,D)self:createVisitorsTab(E,D)self:createPlayersTab(E,D)E:setActive("main")self.frame:add(l)h.super.createUI(self)end;function h:updateMainTab(l)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("main")local G=n:get(m..".raid")if F.raid then G.obj.textColor=colors.red;G:update("Yes")else G.obj.textColor=colors.green;G:update("No")end;local H=n:get(m..".happiness")if F.happiness<5 then H.obj.textColor=colors.red elseif F.happiness<8 then H.obj.textColor=colors.yellow else H.obj.textColor=colors.green end;H:update(string.format("%d/10",self.progress.status.happiness))local I=n:get(m..".citizens")local J=F.tavernCount*4;local K=F.maxCitizens-J;if F.citizenCount==K then I.obj.textColor=colors.green elseif F.citizenCount>F.maxCitizens then I.obj.textColor=colors.red else I.obj.textColor=colors.yellow end;I:update(string.format("%d/%d",F.citizenCount,F.maxCitizens))local L=n:get(m..".graves")if F.graves>0 then L.obj.textColor=colors.red else L.obj.textColor=colors.green end;L:update(tostring(F.graves))local M=n:get(m..".contructions")M:update(tostring(F.constructionCount))local N=n:get(m..".requests")if#F.requests>0 then N.obj.textColor=colors.yellow else N.obj.textColor=colors.green end;N:update(tostring(#F.requests))local O=n:get(m..".buildings")O:update(tostring(#F.buildings))local P=n:get(m..".visitors")P:update(tostring(F.visitorCount))local Q=n:get(m..".players")Q:update(tostring(#F.players))end;function h:updateCitizensTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("citizens")local x=n:get(m..".citizenListFrame")local R=math.max(v-1,F.citizenCount)if x.obj.height~=R then x.obj.height=R;x:render()end;local S=n:get(m..".citizenList")local T={}for C,U in pairs(F.citizens)do local V="Unemployed"if U.job~=nil then V=U.job end;T[#T+1]=string.format("%s %s",V,U.name)end;table.sort(T)S:update(T)end;function h:updateRequestsTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("requests")local y=n:get(m..".requestListFrame")local R=math.max(v-1,#F.requests)if y.obj.height~=R then y.obj.height=R;y:render()end;local W=n:get(m..".requestList")local X={}for C,Y in pairs(F.requests)do X[#X+1]=Y.desc end;table.sort(X)W:update(X)end;function h:updateBuildingsTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("buildings")local z=n:get(m..".buildingListFrame")local R=math.max(v-1,#F.buildings)if z.obj.height~=R then z.obj.height=R;z:render()end;local Z=n:get(m..".buildingList")local _={}for C,a0 in pairs(F.buildings)do local a1=string.gsub(a0.type,"^%l",string.upper)_[#_+1]=string.format("L%d %s",a0.level,a1)end;table.sort(_)Z:update(_)end;function h:updateVisitorsTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("visitors")local A=n:get(m..".visitorListFrame")local R=math.max(v-1,F.visitorCount)if A.obj.height~=R then A.obj.height=R;A:render()end;local a2=n:get(m..".visitorList")local a3={}for C,a4 in pairs(F.visitors)do a3[#a3+1]=a4.name end;table.sort(a3)a2:update(a3)end;function h:updatePlayersTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("players")local B=n:get(m..".playerListFrame")local R=math.max(v-1,#F.players)if B.obj.height~=R then B.obj.height=R;B:render()end;local a5=n:get(m..".playerList")local a6={}for C,a7 in pairs(F.players)do a6[#a6+1]=string.format("%s %s",a7.rank,a7.name)end;table.sort(a6)a5:update(a6)end;function h:update(i,a8)local m=self:getBaseId()local C,v=self.output.getSize()if a8.name==d.c.Event.Colonies.status_poll then self.progress.status=a8.status end;local a9=self.frame:get(m..".titleText",self.output)a9:update(self.progress.status.name)local l=self.frame:get(m..".tabsBase",self.output)self:updateMainTab(l)self:updateCitizensTab(l,v)self:updateRequestsTab(l,v)self:updateBuildingsTab(l,v)self:updateVisitorsTab(l,v)self:updatePlayersTab(l,v)end;function h:handle(i,a8,aa)if a8==d.c.Event.Colonies.status_poll then self:update(i,aa[1])else self.frame:handle(self.output,{a8,table.unpack(aa)})end end;return h
