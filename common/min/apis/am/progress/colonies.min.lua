local a=require("cc.expect")require(settings.get("ghu.base").."core/apis/ghu")local b=require("am.ui.base").BaseObject;local c=require("am.ui")local d=require("am.event")local e=require("am.progress.base")local f=b:extend("am.progress.ColonyProgress")function f:init(g)f.super.init(self)self.id=g;self.status=nil;self.text=""return self end;local h=e:extend("am.progress.QuarryWrapper")function h:init(i,g,j,k)h.super.init(self,i,f(g),j,k)self.names={[d.c.Event.Colonies.status_poll]=true}return self end;function h:createMainTab(l)local m=self:getBaseId()local n=l:getTab("main").obj;local o=3;local p=1;n:add(c.Text(c.a.Left(p),"Raid"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".raid"}))p=p+1;n:add(c.Text(c.a.Left(p),"Happiness"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".happiness"}))p=p+1;n:add(c.Text(c.a.Left(p),"Citizens"))n:add(c.Text(c.a.Right(p,o),"/",{id=m..".citizens"}))local q=c.Button(c.a.Right(p),"\x17",{id=m..".citizenTabButton",fillColor=colors.blue,textColor=colors.white,border=0})q:addActivateHandler(function()l:setActive("citizens")end)n:add(q)p=p+1;n:add(c.Text(c.a.Left(p),"Graves"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".graves"}))p=p+1;n:add(c.Text(c.a.Left(p),"Contructions"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".contructions"}))p=p+1;n:add(c.Text(c.a.Left(p),"Requests"))local r=c.Button(c.a.Right(p),"\x17",{id=m..".requestsTabButton",fillColor=colors.blue,textColor=colors.white,border=0})r:addActivateHandler(function()l:setActive("requests")end)n:add(r)n:add(c.Text(c.a.Right(p,o),"",{id=m..".requests"}))p=p+1;n:add(c.Text(c.a.Left(p),"Buildings"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".buildings"}))local s=c.Button(c.a.Right(p),"\x17",{id=m..".buildingsTabButton",fillColor=colors.red,textColor=colors.white,border=0})s:addActivateHandler(function()l:setActive("buildings")end)n:add(s)p=p+1;n:add(c.Text(c.a.Left(p),"Visitors"))n:add(c.Text(c.a.Right(p,o),"",{id=m..".visitors"}))local t=c.Button(c.a.Right(p),"\x17",{id=m..".visitorsTabButton",fillColor=colors.green,textColor=colors.white,border=0})t:addActivateHandler(function()l:setActive("visitors")end)n:add(t)p=p+1;n:add(c.Text(c.a.Left(p),"Players"))local u=c.Button(c.a.Right(p),"\x17",{id=m..".playersTabButton",fillColor=colors.blue,textColor=colors.white,border=0})u:addActivateHandler(function()l:setActive("players")end)n:add(u)n:add(c.Text(c.a.Right(p,o),"",{id=m..".players"}))n:add(c.Text(c.a.Bottom(),"",{id=m..".statusText"}))end;function h:createCitizensTab(l,v)local m=self:getBaseId()local n=l:createTab("citizens")n:add(c.Text(c.a.TopLeft(),"Citizens"))local w=c.Button(c.a.TopRight(),"x",{id=m..".citizenCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local x=c.Frame(c.a.Anchor(1,2),{id=m..".citizenListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})x:add(c.Text(c.a.TopLeft(),"",{id=m..".citizenList"}))n:add(x)end;function h:createRequestsTab(l,v)local m=self:getBaseId()local n=l:createTab("requests")n:add(c.Text(c.a.TopLeft(),"Requests"))local w=c.Button(c.a.TopRight(),"x",{id=m..".requestCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local y=c.Frame(c.a.Anchor(1,2),{id=m..".requestListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})y:add(c.Text(c.a.TopLeft(),"",{id=m..".requestList"}))n:add(y)end;function h:createBuildingsTab(l,v)local m=self:getBaseId()local n=l:createTab("buildings")n:add(c.Text(c.a.TopLeft(),"Buildings"))local w=c.Button(c.a.TopRight(),"x",{id=m..".buildingCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local z=c.Frame(c.a.Anchor(1,2),{id=m..".buildingListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})z:add(c.Text(c.a.TopLeft(),"",{id=m..".buildingList"}))n:add(z)end;function h:createVisitorsTab(l,v)local m=self:getBaseId()local n=l:createTab("visitors")n:add(c.Text(c.a.TopLeft(),"Visitors"))local w=c.Button(c.a.TopRight(),"x",{id=m..".visitorCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local A=c.Frame(c.a.Anchor(1,2),{id=m..".visitorListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})A:add(c.Text(c.a.TopLeft(),"",{id=m..".visitorList"}))n:add(A)end;function h:createPlayersTab(l,v)local m=self:getBaseId()local n=l:createTab("players")n:add(c.Text(c.a.TopLeft(),"Players"))local w=c.Button(c.a.TopRight(),"x",{id=m..".playerCloseButton",fillColor=colors.red,border=0})w:addActivateHandler(function()l:setActive("main")end)n:add(w)local B=c.Frame(c.a.Anchor(1,2),{id=m..".playerListFrame",fillColor=colors.lightGray,textColor=colors.black,fillHorizontal=true,scrollBar=true,height=v-1,border=0,padTop=1,padLeft=1})B:add(c.Text(c.a.TopLeft(),"",{id=m..".playerList"}))n:add(B)end;function h:createUI()local m=self:getBaseId()local C,v=self.output.getSize()local D=v-2;self.frame:add(c.Text(c.a.Top(),"",{id=m..".titleText"}))if _G.PROGRESS_SHOW_CLOSE then local w=c.Button(c.a.TopRight(),"x",{id=m..".closeButton",fillColor=colors.red,border=0})w:addActivateHandler(function()_G.RUN_PROGRESS=false end)self.frame:add(w)end;local l=c.TabbedFrame(c.a.Anchor(1,3),{id=m..".tabsBase",fillColor=colors.black,textColor=colors.white,border=0,fillVertical=true,fillHorizontal=true})local E=l:bind(self.output)self:createMainTab(E)self:createCitizensTab(E,D)self:createRequestsTab(E,D)self:createBuildingsTab(E,D)self:createVisitorsTab(E,D)self:createPlayersTab(E,D)E:setActive("main")self.frame:add(l)h.super.createUI(self)end;function h:updateMainTab(l)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("main")local G=n:get(m..".statusText")G:update(self.progress.text)local H=n:get(m..".raid")if F.raid then H.obj.textColor=colors.red;H:update("Yes")else H.obj.textColor=colors.green;H:update("No")end;local I=n:get(m..".happiness")if F.happiness<5 then I.obj.textColor=colors.red elseif F.happiness<8 then I.obj.textColor=colors.yellow else I.obj.textColor=colors.green end;I:update(string.format("%d/10",self.progress.status.happiness))local J=n:get(m..".citizens")local K=F.tavernCount*4;local L=F.maxCitizens-K;if F.citizenCount==L then J.obj.textColor=colors.green elseif F.citizenCount>F.maxCitizens then J.obj.textColor=colors.red else J.obj.textColor=colors.yellow end;J:update(string.format("%d/%d",F.citizenCount,F.maxCitizens))local M=n:get(m..".graves")if F.graves>0 then M.obj.textColor=colors.red else M.obj.textColor=colors.green end;M:update(tostring(F.graves))local N=n:get(m..".contructions")N:update(tostring(F.constructionCount))local O=n:get(m..".requests")if#F.requests>0 then O.obj.textColor=colors.yellow else O.obj.textColor=colors.green end;O:update(tostring(#F.requests))local P=n:get(m..".buildings")P:update(tostring(#F.buildings))local Q=n:get(m..".visitors")Q:update(tostring(F.visitorCount))local R=n:get(m..".players")R:update(tostring(#F.players))end;function h:updateCitizensTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("citizens")local x=n:get(m..".citizenListFrame")local S=math.max(v-1,F.citizenCount)if x.obj.height~=S then x.obj.height=S;x:render()end;local T=n:get(m..".citizenList")local U={}for C,V in pairs(F.citizens)do local W="Unemployed"if V.job~=nil then W=V.job end;U[#U+1]=string.format("%s %s",W,V.name)end;table.sort(U)T:update(U)end;function h:updateRequestsTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("requests")local y=n:get(m..".requestListFrame")local S=math.max(v-1,#F.requests)if y.obj.height~=S then y.obj.height=S;y:render()end;local X=n:get(m..".requestList")local Y={}for C,Z in pairs(F.requests)do Y[#Y+1]=Z.desc end;table.sort(Y)X:update(Y)end;function h:updateBuildingsTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("buildings")local z=n:get(m..".buildingListFrame")local S=math.max(v-1,#F.buildings)if z.obj.height~=S then z.obj.height=S;z:render()end;local _=n:get(m..".buildingList")local a0={}for C,a1 in pairs(F.buildings)do local a2=string.gsub(a1.type,"^%l",string.upper)a0[#a0+1]=string.format("L%d %s",a1.level,a2)end;table.sort(a0)_:update(a0)end;function h:updateVisitorsTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("visitors")local A=n:get(m..".visitorListFrame")local S=math.max(v-1,F.visitorCount)if A.obj.height~=S then A.obj.height=S;A:render()end;local a3=n:get(m..".visitorList")local a4={}for C,a5 in pairs(F.visitors)do a4[#a4+1]=a5.name end;table.sort(a4)a3:update(a4)end;function h:updatePlayersTab(l,v)local F=self.progress.status;local m=self:getBaseId()local n=l:getTab("players")local B=n:get(m..".playerListFrame")local S=math.max(v-1,#F.players)if B.obj.height~=S then B.obj.height=S;B:render()end;local a6=n:get(m..".playerList")local a7={}for C,a8 in pairs(F.players)do a7[#a7+1]=string.format("%s %s",a8.rank,a8.name)end;table.sort(a7)a6:update(a7)end;function h:update(i,a9)local m=self:getBaseId()local C,v=self.output.getSize()if a9.name==d.c.Event.Colonies.status_poll then self.progress.status=a9.status;self.progress.text=a9.text end;local aa=self.frame:get(m..".titleText",self.output)aa:update(self.progress.status.name)local l=self.frame:get(m..".tabsBase",self.output)self:updateMainTab(l)self:updateCitizensTab(l,v)self:updateRequestsTab(l,v)self:updateBuildingsTab(l,v)self:updateVisitorsTab(l,v)self:updatePlayersTab(l,v)end;function h:updateStatus(i,F)self.progress.text=F;local m=self:getBaseId()local G=self.frame:get(m..".statusText")G:update(self.progress.text)end;function h:handle(i,a9,ab)if a9==d.c.Event.Colonies.status_poll then self:update(i,ab[1])else self.frame:handle(self.output,{a9,table.unpack(ab)})end end;return h
