local a=require("cc.expect")require(settings.get("ghu.base").."core/apis/ghu")local b=require("am.ui")local c=require("am.event")local d=require("am.core")local e=require("am.progress.helpers")local f=require("am.progress.quarry")local g=require("am.progress.tree")local h=require("am.progress.colonies")local i={}local j={}local k=nil;local function l(m,n)if not n then return b.Frame(b.a.Anchor(1,1),{id=string.format("progressFrame.%d",m.id),fillHorizontal=true,fillVertical=true,border=0,backgroundColor=colors.black,textColor=colors.white})end;if k==nil then k=b.TabbedFrame(b.a.Anchor(1,1),{id="progressFrame",fillHorizontal=true,fillVertical=true,border=0,backgroundColor=colors.black,textColor=colors.white,primaryTabId=tostring(m.id)})return k.tabs[1]end;return k:createTab(m.id)end;local function o(m,p,q,n)a.expect(1,m,"table")a.expect(2,q,"table","nil")a.expect(3,p,"table","nil")a.expect(4,n,"boolean","nil")local r=q~=nil and p~=nil;if q~=nil then b.h.requireOutput(q)end;if n==nil then n=false end;local s=j[m.id]local t=false;if r then if s~=nil then local u=s.output;if b.h.isFrameScreen(u)then u=b.h.getFrameScreen(u).output end;if not s.names[p.name]or not b.h.isSameScreen(u,q)then j[m.id]=nil;s=nil end end;if s==nil then n=n and b.h.isTerm(q)if n then q=k:makeScreen(q)end;if p.name==c.c.Event.Progress.quarry then s=f(m,p,q,l(m,n))s:createUI()j[m.id]=s elseif p.name==c.c.Event.Progress.tree then s=g(m,p,q,l(m,n))s:createUI()j[m.id]=s elseif p.name==c.c.Event.Colonies.status_poll then s=h(m,p.status.id,q,l(m,n))s.progress.status=p.status;s:createUI()j[m.id]=s end;t=s~=nil;if s~=nil and k~=nil then k:setActive(q,k.active)end end end;return s,t end;local function v(q)for w,s in pairs(j)do local u=s.output;if b.h.isFrameScreen(u)then u=b.h.getFrameScreen(u).output end;if b.h.isSameScreen(q,u)then return{id=w}end end;return nil end;local function x(m,y)a.expect(1,m,"table")a.expect(2,y,"string")local s=o(m)if s~=nil then s:updateStatus(y)end end;local function z(m,p,q,n)a.expect(1,m,"table")a.expect(2,p,"table")a.expect(3,q,"table","nil")a.expect(4,n,"boolean","nil")if q==nil then q=term else b.h.requireOutput(q)end;if n==nil then n=false end;local s,t=o(m,p,q,n)if s~=nil and not t then s:update(p)end end;local function A(p,B)for C,s in pairs(j)do s:handle(p,B)end end;local function D(m,p,B)local E=nil;if b.c.l.Events.Always[p]then A(p,B)return elseif b.c.l.Events.UI[p]then local F=d.split(B[1].objId,".")if F[1]=="progressFrame"then E={id=tonumber(F[2])}end elseif b.c.l.Events.Terminal[p]then E=v(term)elseif b.c.l.Events.Monitor[p]then E=v(peripheral.wrap(B[1]))end;if E~=nil then m=E end;local s,C=o(m)if s~=nil then s:handle(p,B)end end;i.updateStatus=x;i.print=z;i.handle=D;i.itemStrings=e.itemStrings;return i
